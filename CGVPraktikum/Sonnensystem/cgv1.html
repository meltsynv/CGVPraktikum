<!--Copyright © 2020 Raoul Müller. All rights reserved.-->

<!--todo: Recherchieren Sie zum Thema Skybox in Babylon.js und ergänzen Sie eine passende Skybox.-->

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-en">
<head>
    <meta charset="utf-8">
    <title>computer graphics and visualization - task 1 - Raoul Müller</title>
    <script src="babylon.custom.js"></script>
    <style type="text/css">
        html, body, canvas {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<canvas id="renderCanvas"></canvas>
<script>
    if (!BABYLON.Engine.isSupported()) {
        window.alert('Browser not supported');
    } else {
        // setting up the scene
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);
        const scene = new BABYLON.Scene(engine);

        // defining the point of view
        new BABYLON.ArcRotateCamera("camera", -Math.PI / 4.0, 0.25 * Math.PI, 20.0, new BABYLON.Vector3(0, 0, 0), scene);
        scene.activeCamera.attachControl(canvas);

        // defining the light source
        const light = new BABYLON.PointLight("light", new BABYLON.Vector3(-0.0, -0.0, 0.0), scene);
        light.diffuse = new BABYLON.Color3(1.0, 1.0, 1.0);

        // adding the skybox
        scene.clearColor = new BABYLON.Color3(0.05, 0.05, 0.2);

        // creating the objects, adding their materials and adding them to the scene
        const sun = BABYLON.Mesh.CreateSphere("sun", 10.0, 1, scene);
        const sunMaterial = new BABYLON.StandardMaterial("sunMaterial", scene);
        sunMaterial.diffuseTexture = new BABYLON.Texture("assets/sun.jpg", scene);
        sunMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
        sunMaterial.emissiveColor = new BABYLON.Color3(1, 1, 1);
        sun.material = sunMaterial;

        const earth = BABYLON.Mesh.CreateSphere("earth", 30.0, 0.3, scene);
        const earthMaterial = new BABYLON.StandardMaterial("earthMaterial", scene);
        earthMaterial.diffuseTexture = new BABYLON.Texture("assets/earth.jpg", scene);
        earthMaterial.specularColor = new BABYLON.Color3(0.1, 0.1, 0.1);
        earthMaterial.emissiveColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        earthMaterial.diffuseTexture.vScale = -1;
        earthMaterial.diffuseTexture.uScale = -1;
        earth.material = earthMaterial;

        const moon = BABYLON.Mesh.CreateSphere("moon", 20.0, 0.15, scene);
        const moonMaterial = new BABYLON.StandardMaterial("moonMaterial", scene);
        moonMaterial.diffuseTexture = new BABYLON.Texture("assets/moon.jpg", scene);
        moonMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
        moonMaterial.emissiveColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        moonMaterial.diffuseTexture.vScale = -1;
        moonMaterial.diffuseTexture.uScale = -1;
        moon.material = moonMaterial;

        const satellite = BABYLON.Mesh.CreateSphere("satellite", 20.0, 0.05, scene);
        const satelliteMaterial = new BABYLON.StandardMaterial("satelliteMaterial", scene);
        satelliteMaterial.diffuseTexture = new BABYLON.Texture("assets/metal.jpg", scene);
        satelliteMaterial.specularColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        satelliteMaterial.emissiveColor = new BABYLON.Color3(0.3, 0.3, 0.3);
        satelliteMaterial.diffuseTexture.vScale = -1;
        satelliteMaterial.diffuseTexture.uScale = -1;
        satellite.material = satelliteMaterial;

        const mars = BABYLON.Mesh.CreateSphere("mars", 30.0, 0.25, scene);
        const marsMaterial = new BABYLON.StandardMaterial("marsMaterial", scene);
        marsMaterial.diffuseTexture = new BABYLON.Texture("assets/mars.jpg", scene);
        marsMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
        marsMaterial.emissiveColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        marsMaterial.diffuseTexture.vScale = -1
        marsMaterial.diffuseTexture.uScale = -1;
        mars.material = marsMaterial;

        const phobos = BABYLON.Mesh.CreateSphere("phobos", 20.0, 0.1, scene);
        const phobosMaterial = new BABYLON.StandardMaterial("phobosMaterial", scene);
        // source: https://www.deviantart.com/askaniy/art/Phobos-Texture-Map-784146561
        phobosMaterial.diffuseTexture = new BABYLON.Texture("assets/phobos.png", scene);
        phobosMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
        phobosMaterial.emissiveColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        phobosMaterial.diffuseTexture.vScale = -1
        phobosMaterial.diffuseTexture.uScale = -1;
        phobos.material = phobosMaterial;

        const deimos = BABYLON.Mesh.CreateSphere("deimos", 20.0, 0.1, scene);
        const deimosMaterial = new BABYLON.StandardMaterial("deimosMaterial", scene);
        // source: https://www.deviantart.com/magentameteorite/art/Fictional-Deimos-Texture-Map-732067610
        deimosMaterial.diffuseTexture = new BABYLON.Texture("assets/deimos.jpg", scene);
        deimosMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
        deimosMaterial.emissiveColor = new BABYLON.Color3(0.2, 0.2, 0.2);
        deimosMaterial.diffuseTexture.vScale = -1
        deimosMaterial.diffuseTexture.uScale = -1;
        deimos.material = deimosMaterial;

        scene.beforeRender = function () {
            //==========================================================================================================
            const twoPi = 2 * Math.PI;

            // the task says one year should last one minute, but for the mars moons this is too fast (aliasing)
            const daysPerMinute = 60; //365.24;
            const day = daysPerMinute / 60 * new Date().getTime() / 1000;

            // source: https://spacemath.gsfc.nasa.gov/sun/4Page1.pdf
            const sunDaysInDays = 26.6;
            sun.rotation.y = -day / sunDaysInDays * twoPi;

            // define natural constants, calculate positions and angles, assign them to the objects
            const earthYearInDays = 365.24;
            const earthDayInDays = 1;
            const distanceEarthSun = 3;
            const earthX = distanceEarthSun * Math.sin(-day / earthYearInDays * twoPi);
            const earthZ = distanceEarthSun * Math.cos(-day / earthYearInDays * twoPi);
            const earthAngle = -day / earthDayInDays * twoPi;
            earth.position.x = earthX;
            earth.position.z = earthZ;
            earth.rotation.y = earthAngle;

            const moonYearInDays = 27.3;
            const moonDayInDays = moonYearInDays;
            const distanceMoonEarth = 0.5;
            const moonX = earthX + distanceMoonEarth * Math.sin(-day / moonYearInDays * twoPi);
            const moonZ = earthZ + distanceMoonEarth * Math.cos(-day / moonYearInDays * twoPi);
            const moonAngle = (-day / moonDayInDays + 0.25) * twoPi;
            moon.position.x = moonX;
            moon.position.z = moonZ;
            moon.rotation.y = moonAngle;

            const satelliteYearInDays = moonDayInDays / 3;
            const satelliteDayInDays = satelliteYearInDays;
            const distanceSatelliteMoon = 0.125;
            const satelliteX = moonX + distanceSatelliteMoon * Math.sin(-day / satelliteYearInDays * twoPi);
            const satelliteZ = moonZ + distanceSatelliteMoon * Math.cos(-day / satelliteYearInDays * twoPi);
            const satelliteAngle = -day / satelliteDayInDays * twoPi;
            satellite.position.x = satelliteX;
            satellite.position.z = satelliteZ;
            satellite.rotation.y = satelliteAngle;

            const marsYearInDays = 687;
            const marsDayInDays = 1 + 39 / 60 / 24;
            const distanceMarsSun = 5;
            const marsX = distanceMarsSun * Math.sin(-day / marsYearInDays * twoPi);
            const marsZ = distanceMarsSun * Math.cos(-day / marsYearInDays * twoPi);
            const marsAngle = -day / marsDayInDays * twoPi;
            mars.position.x = marsX;
            mars.position.z = marsZ;
            mars.rotation.y = marsAngle;

            // "[Phobos] benötigt für einen Umlauf nur 7 Stunden, 39 Minuten und 12 Sekunden.
            // [Phobos] wendet dem Mars immer dieselbe Seite zu."
            // source: https://de.wikipedia.org/wiki/Phobos_(Mond)#Eigenschaften
            const phobosYearInDays = (7 + (39 + 12 / 60) / 60) / 24;
            const phobosDayInDays = phobosYearInDays;
            const distancePhobosMars = 0.25;
            const phobosX = marsX + distancePhobosMars * Math.sin(-day / phobosYearInDays * twoPi);
            const phobosZ = marsZ + distancePhobosMars * Math.cos(-day / phobosYearInDays * twoPi);
            const phobosAngle = -day / phobosDayInDays * twoPi;
            phobos.position.x = phobosX;
            phobos.position.z = phobosZ;
            phobos.rotation.y = phobosAngle;

            // "[Deimos] benötigt für einen Marsumlauf 1 Tag, 6 Stunden und 18 Minuten.
            // [Deimos] wendet dem Mars immer dieselbe Seite zu."
            // source: https://de.wikipedia.org/wiki/Deimos_(Mond)#Umlaufbahn
            const deimosYearInDays = 1 + (6 + 18 / 60) / 24;
            const deimosDayInDays = deimosYearInDays;
            const distanceDeimosMars = 0.5;
            const deimosX = marsX + distanceDeimosMars * Math.sin(-day / deimosYearInDays * twoPi);
            const deimosZ = marsZ + distanceDeimosMars * Math.cos(-day / deimosYearInDays * twoPi);
            const deimosAngle = -day / deimosDayInDays * twoPi;
            deimos.position.x = deimosX;
            deimos.position.z = deimosZ;
            deimos.rotation.y = deimosAngle;
            //==========================================================================================================
        };

        window.addEventListener("resize", () => engine.resize());

        const renderLoop = () => {
            engine.beginFrame();
            scene.render();
            engine.endFrame();
            BABYLON.Tools.QueueNewFrame(renderLoop);
        };
        BABYLON.Tools.QueueNewFrame(renderLoop);
    }
</script>
</body>
</html>
